<%
  f = taglib("/lib/form")

  f.section(:title => "Gitlab Web Hook Configuration") do

   f.optionalBlock :title => "Automatic project creation", :name => 'autocreate', :checked => "#{descriptor.automatic_project_creation?}" do

    f.entry :title => 'Project master branch', :field => 'master_branch' do
      f.textbox :default => "#{descriptor.master_branch}"
    end

    f.entry :title => 'Use master project name', :field => 'use_master_project_name' do
      f.checkbox :checked => "#{descriptor.use_master_project_name?}"
    end

    f.entry :title => 'Description', :field => 'description' do
      f.textbox :default => "#{descriptor.description}"
    end

    f.entry :title => 'Any branch pattern', :field => 'any_branch_pattern' do
      f.textbox :default => "#{descriptor.any_branch_pattern}"
    end

   end

   f.advanced do

     f.entry :title => 'Template based job creation' do

       f.repeatable :items => descriptor.templated_jobs.to_a, :var => 'templates', :add => 'Add new template' do
         %><table width="100%"><%
         f.entry :title => 'Match string', :field => 'string' do
           f.textbox :default => "#{templates.nil? ? '' : templates.first }"
	   end
         f.entry :title => 'Base project', :field => 'project' do
           f.textbox :default => "#{templates.nil? ? '' : templates.last }"
         end
         %></table><div align="right"><%f.repeatableDeleteButton%></div><%
       end

     end

     f.entry :title => 'Templates for gitlab groups' do
       f.repeatable :items => descriptor.templated_groups.to_a, :var => 'group_templates', :add => 'Add new group template' do
         %><table width="100%"><%
         f.entry :title => 'Match string', :field => 'string' do
           f.textbox :default => "#{group_templates.nil? ? '' : group_templates.first }"
	   end
         f.entry :title => 'Base project', :field => 'project' do
           f.textbox :default => "#{group_templates.nil? ? '' : group_templates.last }"
         end
         %></table><div align="right"><%f.repeatableDeleteButton%></div><%
       end
     end

     f.entry :title => 'Last resort template', :field => 'template' do
       f.textbox :default => "#{descriptor.template_fallback}"
     end

   end

 end
%>
